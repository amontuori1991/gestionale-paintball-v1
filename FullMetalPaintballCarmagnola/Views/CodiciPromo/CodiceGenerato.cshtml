@model Full_Metal_Paintball_Carmagnola.Models.CodicePromozionale

@{
    ViewData["Title"] = "Codice Generato";
}

<div class="text-center">
    <h2>🎉 Il tuo codice è pronto!</h2>

    <div id="buonoContainer" class="mx-auto mt-4 p-4" style="max-width: 400px; background-color: white; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">

        <!-- LOGO -->
        <img src="~/img/logo.gif" alt="Logo" style="max-width: 150px; margin-bottom: 20px;" />

        <!-- QR Code -->
        @if (ViewBag.QRCode != null)
        {
            <img src="data:image/png;base64,@ViewBag.QRCode" alt="QR Code" style="width: 180px; height: 180px; margin-bottom: 20px;" />
        }
        else
        {
            <p class="text-danger">⚠️ Errore nella generazione del QR code.</p>
        }


        @if (ViewBag.DescrizionePromo != null)
        {
            <p class="mt-3"><strong>@ViewBag.DescrizionePromo</strong></p>
        }


        <h3 class="text-success">@Model.Codice</h3>
        <p>Valido fino al <strong>@Model.DataScadenza.ToString("dd/MM/yyyy")</strong></p>
        <p><strong>Instagram:</strong> @Model.InstagramAccount</p>
        <p class="text-warning mt-3">
            ⚠️ Ricorda: per poter utilizzare il buono, è necessario seguire la nostra pagina Instagram.
        </p>
    </div>


    <div class="mt-4">
        <a href="/" class="btn btn-outline-primary me-2">🏠 Torna alla Home</a>
        <button id="downloadBtn" class="btn btn-outline-success">⬇️ Scarica Buono</button>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        document.getElementById('downloadBtn').addEventListener('click', function () {
            const container = document.getElementById('buonoContainer');

            html2canvas(container, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'buono_promozionale.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });
    </script>
}
